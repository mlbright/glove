<h1 class="text-2xl font-bold text-slate-900">Import CSV</h1>
<p class="mt-2 text-sm text-slate-600">Upload a CSV file from your bank to import transactions.</p>

<%= form_with url: csv_imports_path, method: :post, multipart: true, class: "mt-8 max-w-lg space-y-6" do |f| %>
  <div>
    <label for="account_id" class="block text-sm font-medium text-slate-700">Account</label>
    <select name="account_id" id="account_id" required class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm">
      <option value="">Select an account...</option>
      <% @accounts.each do |account| %>
        <option value="<%= account.id %>" <%= "selected" if params[:account_id].to_s == account.id.to_s %>>
          <%= account.name %>
        </option>
      <% end %>
    </select>
    <% if @accounts.empty? %>
      <p class="mt-1 text-sm text-amber-600">
        No accounts found. <%= link_to "Create an account", new_account_path, class: "underline" %> first.
      </p>
    <% end %>
  </div>

  <div>
    <label for="format_type" class="block text-sm font-medium text-slate-700">Import Format</label>
    <select name="format_type" id="format_type" required class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm">
      <option value="">Select a format...</option>
      <% @formats.each do |key, label| %>
        <option value="<%= key %>" <%= "selected" if params[:format_type] == key %>>
          <%= label %>
        </option>
      <% end %>
    </select>
    <p class="mt-1 text-xs text-slate-500">
      Select the format that matches your bank's CSV export.
    </p>
  </div>

  <div>
    <label for="csv_file" class="block text-sm font-medium text-slate-700">CSV File</label>
    <input type="file" name="csv_file" id="csv_file" accept=".csv,text/csv" required
           class="mt-1 block w-full text-sm text-slate-500
                  file:mr-4 file:py-2 file:px-4
                  file:rounded file:border-0
                  file:text-sm file:font-semibold
                  file:bg-emerald-50 file:text-emerald-700
                  hover:file:bg-emerald-100">
  </div>

  <div class="rounded-md bg-slate-100 p-4">
    <h3 class="text-sm font-medium text-slate-700">Supported Formats</h3>
    <dl class="mt-2 space-y-3 text-sm">
      <div>
        <dt class="font-medium text-slate-600">TD Chequing Account</dt>
        <dd class="text-slate-500">
          CSV with columns: Date (YYYY-MM-DD), Description, Debit, Credit, Balance<br>
          Example: <code class="bg-white px-1">"2025-11-14","ACME Corp PAY",,"1000.00","1500.00"</code>
        </dd>
      </div>
      <div>
        <dt class="font-medium text-slate-600">TD Visa Credit Card</dt>
        <dd class="text-slate-500">
          CSV with columns: Date (MM/DD/YYYY), Description, Debit, Credit, Balance<br>
          Example: <code class="bg-white px-1">11/24/2025,BALANCE PROTECTION INS,20.67,,2109.88</code>
        </dd>
      </div>
      <div>
        <dt class="font-medium text-slate-600">PC Financial Mastercard</dt>
        <dd class="text-slate-500">
          CSV with header and columns: Description, Type, Card Holder Name, Date (MM/DD/YYYY), Time, Amount<br>
          Example: <code class="bg-white px-1">"TIM HORTONS #1723","PURCHASE","JOHN","12/11/2025","01:35 AM","-1.92"</code>
        </dd>
      </div>
    </dl>
  </div>

  <div>
    <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-emerald-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
      Import Transactions
    </button>
    <%= link_to "Cancel", transactions_path, class: "ml-3 text-sm text-slate-600 hover:text-slate-900" %>
  </div>
<% end %>
