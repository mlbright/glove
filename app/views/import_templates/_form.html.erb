<%= form_with model: @import_template, class: "space-y-6" do |form| %>
  <div>
    <%= form.label :name, class: "block text-sm font-medium" %>
    <%= form.text_field :name, class: "mt-1 w-full rounded border border-slate-300 px-3 py-2" %>
  </div>
  <div class="grid gap-4 md:grid-cols-3">
    <div>
      <%= form.label :delimiter, class: "block text-sm font-medium" %>
      <%= form.text_field :delimiter, value: @import_template.delimiter || ",", class: "mt-1 w-full rounded border border-slate-300 px-3 py-2" %>
    </div>
    <div class="flex items-center gap-2 mt-6">
      <%= form.check_box :header, checked: @import_template.header != false %>
      <%= form.label :header, "CSV includes header row" %>
    </div>
  </div>
  <div>
    <%= form.label :column_examples, "Sample CSV rows", class: "block text-sm font-medium" %>
    <%= form.text_area :column_examples, rows: 3, value: Array(@import_template.column_examples).join("\n"), class: "mt-1 w-full rounded border border-slate-300 px-3 py-2" %>
    <p class="mt-1 text-xs text-slate-500">Paste a header row and optional sample rows to help remember the format.</p>
  </div>
  <div>
    <h3 class="text-sm font-semibold text-slate-700">Column Mapping</h3>
    <p class="text-xs text-slate-500">Map each incoming column to an application field.</p>
    <div class="mt-3 space-y-3">
      <% (@mapping_rows || []).each_with_index do |row, index| %>
        <div class="grid gap-3 md:grid-cols-2">
          <div>
            <label class="text-xs text-slate-500">CSV column</label>
            <input type="text" name="import_template[mapping_rows][<%= index %>][column]" value="<%= row[:column] %>" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-500">Maps to</label>
            <select name="import_template[mapping_rows][<%= index %>][attribute]" class="mt-1 w-full rounded border border-slate-300 px-3 py-2">
              <option value=""></option>
              <% ImportTemplate::SUPPORTED_FIELDS.each do |field| %>
                <option value="<%= field %>" <%= "selected" if row[:attribute] == field %>><%= field.humanize %></option>
              <% end %>
            </select>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div>
    <%= form.submit class: "rounded bg-emerald-600 px-4 py-2 text-white" %>
  </div>
<% end %>
