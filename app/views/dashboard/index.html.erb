<div class="grid gap-6 md:grid-cols-3">
  <div class="rounded bg-white p-6 shadow">
    <p class="text-sm uppercase text-slate-500">Total Income</p>
    <p class="mt-2 text-3xl font-semibold text-emerald-600"><%= number_to_currency(@total_income) %></p>
  </div>
  <div class="rounded bg-white p-6 shadow">
    <p class="text-sm uppercase text-slate-500">Total Expenses</p>
    <p class="mt-2 text-3xl font-semibold text-rose-500"><%= number_to_currency(@total_expenses) %></p>
  </div>
  <div class="rounded bg-white p-6 shadow">
    <p class="text-sm uppercase text-slate-500">Net Balance</p>
    <p class="mt-2 text-3xl font-semibold <%= @net_total >= 0 ? "text-emerald-600" : "text-rose-500" %>"><%= number_to_currency(@net_total) %></p>
  </div>
</div>

<div class="mt-10 grid gap-6 md:grid-cols-2">
  <div class="rounded bg-white p-6 shadow">
    <h2 class="text-lg font-semibold text-slate-900">Accounts</h2>
    <ul class="mt-4 space-y-3">
      <% @accounts.each do |account| %>
        <li class="flex items-center justify-between">
          <div>
            <p class="font-medium text-slate-800"><%= account.name %></p>
            <p class="text-sm text-slate-500"><%= account.account_type.humanize %></p>
          </div>
          <p class="text-base font-semibold <%= account.balance >= 0 ? "text-emerald-600" : "text-rose-500" %>"><%= number_to_currency(account.balance) %></p>
        </li>
      <% end %>
    </ul>
    <div class="mt-4 text-right">
      <%= link_to "Manage accounts", accounts_path, class: "text-sm text-emerald-600" %>
    </div>
  </div>

  <div class="rounded bg-white p-6 shadow">
    <h2 class="text-lg font-semibold text-slate-900">Bulk import</h2>
    <p class="mt-1 text-sm text-slate-500">Use templates to map CSV columns, then upload batches to create transactions in bulk.</p>

    <div class="mt-4">
      <p class="text-xs uppercase text-slate-500">Templates</p>
      <% if @import_templates.any? %>
        <ul class="mt-2 space-y-1 text-sm text-slate-700">
          <% @import_templates.first(3).each do |template| %>
            <li class="flex items-center justify-between">
              <span><%= template.name %></span>
              <span class="text-slate-400"><%= template.mapping.keys.count %> fields</span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="mt-2 text-sm text-slate-500">No templates yet.</p>
      <% end %>
    </div>

    <div class="mt-6">
      <p class="text-xs uppercase text-slate-500">Recent batches</p>
      <% if @recent_import_batches.any? %>
        <ul class="mt-2 space-y-2 text-sm text-slate-700">
          <% @recent_import_batches.each do |batch| %>
            <li class="flex items-center justify-between">
              <div>
                <p class="font-medium"><%= batch.import_template.name %></p>
                <p class="text-xs text-slate-500"><%= batch.status.humanize %> • <%= batch.created_at.strftime("%b %d") %></p>
              </div>
              <span class="text-xs"><%= batch.processed_count %> ok / <%= batch.failed_count %> failed</span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="mt-2 text-sm text-slate-500">No batches uploaded.</p>
      <% end %>
    </div>

    <div class="mt-6 flex flex-col gap-2 text-sm">
      <%= link_to "Create template", new_import_template_path, class: "text-emerald-600" %>
      <%= link_to "Upload CSV", new_import_batch_path, class: "text-emerald-600" %>
    </div>
  </div>
</div>

<div class="mt-10 rounded bg-white p-6 shadow">
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold text-slate-900">Recent transactions</h2>
    <%= link_to "View all", transactions_path, class: "text-sm text-emerald-600" %>
  </div>
  <table class="mt-4 w-full text-left text-sm">
    <thead>
      <tr class="text-slate-500">
        <th class="py-2">Date</th>
        <th class="py-2">Account</th>
        <th class="py-2">Memo</th>
        <th class="py-2 text-right">Amount</th>
      </tr>
    </thead>
    <tbody>
      <% @recent_transactions.each do |tx| %>
        <tr class="border-t border-slate-100">
          <td class="py-3"><%= l(tx.occurred_on, format: :long) %></td>
          <td class="py-3"><%= tx.account.name %></td>
          <td class="py-3"><%= tx.memo.presence || "—" %></td>
          <td class="py-3 text-right font-semibold <%= tx.income? ? "text-emerald-600" : "text-rose-500" %>"><%= number_to_currency(tx.amount_signed) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
